# :arrow_right: 트랜잭션 (Transaction)

- 데이터베이스에서 하나의 `논리적 기능`을 수행하기 위한 `작업 단위`
- 여러개의 쿼리를 하나로 묶는 단위
- 데이터의 정합성을 보장하기 위한 기능
- ACID 특징을 가짐

## 💡 특징 (ACID)

### 💙 원자성 (Atomicity)

> "All or Nothing"

- 트랜잭션과 관련된 일이 `모두` 수행되었거나, 되지 않았거나를 보장
- 다시말해 트랜잭션을 커밋했을 때 문제가 발생하여 `롤백`하는 경우, `모두 수행되지 않음`을 보장

- ex) A의 통장잔고에 1000만원, B의 통장잔고에는 0원이 있을 때, A가 B로 500만원을 입금하는 과정

```
  1. A의 잔고를 조회한다.
  2. A의 통장에서 500만원을 뺀다.
  3. B의 통장으로 500만원을 넣는다.
```

- 해당 작업을 `취소`한다고 했을 때, <b>A는 다시 1000만원 B는 0원이 됨</b>
  - 일부 작업만 적용되어 A는 500만원, B는 0원이 될 수 없음

### 💜 일관성 (Consistency)

- `허용된 방식`으로만 데이터를 변경해야하는 것
- 모든 데이터는 여러 가지 조건에 따라 유효성을 갖는데, 해당 <b>조건을 위반한다면 롤백</b>해야 함

- ex) A가 1000만원이 있고 B가 0원이 있을 때, B가 A로 500만원을 입금할 수 없음 (마이너스 통장이 아님을 가정)

### ❤️ 격리성 (Isolation)

- 트랜잭션 수행 시 서로 <b>끼어들지 못하는 것</b>

- 복수의 병렬 트랜잭션은 서로 격리되어, 순차적으로 실행되는 것처럼 작동
- 데이터베이스는 여러 사용자가 같은 데이터에 접근 가능해야 함
- 여러개의 격리 수준(`Isolation Level`)으로 나뉘어져 보장

### 💚 지속성 (Durability)

- `성공적으로 수행`된 트랜잭션은 `영원히 반영`되어야 하는 것
- 데이터베이스에 시스템 장애가 발생해도 원래 상태로 복구하는 회복 기능이 있어야 함을 뜻
- 체크섬, 저널링, 롤백 등을 통해 해결
  - :heavy_check_mark: 체크섬 : `중복 검사`, 오류 정정을 통해 자료 무결성 보호
  - :pencil: 저널링 : 변경 사항을 커밋하기 전에 `로깅` (트랜잭션 변경 사항에 대한 로그)
    <br>

## ⚡ 커밋(Commit) 과 롤백(Rollback)

- 커밋과 롤백으로 인해 데이터의 무결성이 보장
- 데이터 변경 전, 변경 사항을 쉽게 확인 가능
- 작업 그룹화 가능

### :bookmark: 커밋

- 여러 쿼리가 성공적으로 처리되었다고 확정하는 명령어
- 트랜잭션 단위로 수행
- 변경된 내용이 모두 영구적으로 저장
- "`커밋`이 수행되었다" == "`하나의 트랜잭션`이 성공적으로 수행되었다"

### :rewind: 롤백

- 에러나 이슈로 인해 트랜잭션(하나의 묶음 과정) 전으로 돌림

## :mega: 트랜잭션 전파 (Transaction Propagation)

- 트랜잭션을 수행할 때, 커넥션 단위로 수행 --> 커넥션 객체를 통해서 수행해야 함

- 매번 넘기기 귀찮아서 트랜잭션 관련 메서드 호출을 <b> `하나의 트랜잭션`에 묶이도록 하는 것 </b>
- `Spring`의 경우 `@Transactional` 어노테이션(선언적 트랜잭션) 을 통해 <b> <u>여러 쿼리 관련 코드들</u>을 하나의 트랜잭션으로 처리 </b>

## ✨ 무결성이란?

- 데이터의 `정확성`, `일관성`, `유효성`을 유지하는 것

- `데이터베이스에 저장된 데이터 값`과 현실 세계의 `실제 값`이 <U>일치</U>하는지에 대한 신뢰를 위해 필요

### 🔎 개체 무결성

- `기본키`로 선택된 필드는 빈 값을 허용 X

### 🔎 참조 무결성

- 서로 `참조 관계`에 있는 두 테이블의 데이터는 항상 `일관된 값`을 유지해야 함

### 🔎 고유 무결성

- 특정 속성에 대해 `고유한 값`을 가지도록 `조건`이 주어진 경우, 그 속성 값은 `모두 고유한 값`을 가져야 함

### 🔎 NULL 무결성

- 특정 속성 값에 `NOT NULL` 조건이 설정 된 경우, 그 속성 값은 NULL이 될 수 없음

<br>

# :question: 예상 질문

- 트랜잭션이 뭔지 설명해주세요.

- 데이터베이스에서 ACID에 대해 설명해주세요.
- 커밋과 롤백의 차이점에 대해 설명해주세요.
- 무결성에 대해 설명해주세요.

<br>

# :newspaper: Reference

- 면접을 위한 CS 전공지식 노트 : `w.주홍철`
  <br>
- [스프링의 트랜잭션 전파 속성](https://mangkyu.tistory.com/269)
- [트랜잭션 격리 수준](https://mangkyu.tistory.com/299)
